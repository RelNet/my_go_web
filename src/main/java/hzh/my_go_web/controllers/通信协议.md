# 通信协议

该文档协议是由类似Json格式书写，但是实际通信是使用Protocol Buffer

1表示交互提起方，2表示回应方

## User Protocol

| 行为             | 客户端                                                   | 服务端                                                       |
| ---------------- | -------------------------------------------------------- | ------------------------------------------------------------ |
| 注册             | 1{name:string, password:string, behavior:SING_UP}        | 2成功{status:SUCCESS, id:int}<br />失败{status:FAIL, msg:string} |
| 登陆             | 1{id:int, password:string, behavior:LOGIN}               | 2成功{status:SUCCESS}<br />失败{status:FAIL, msg:string}     |
| 更新用户名和密码 | 1{id:int, name:string, password:string, behavior:UPDATE} | 2成功{status:SUCCESS}<br />失败{status:FAIL, msg:string}     |
| 获取用户名       | 1{id:int, behavior:GET_NAME}                             | 2成功{status:SUCCESS, name:string}<br />失败{status:FAIL, msg:string} |
| 获取所有在线用户 | 1{behavior:GET_ONLINE_USERS}                             | 2成功{status:SUCCESS, onlineUsers:list}<br />失败{status:FAIL, msg:string} |

## Rank Protocol

| 行为         | 客户端                       | 服务端                                                       |
| ------------ | ---------------------------- | ------------------------------------------------------------ |
| 获取个人排行 | 1{id:int, behavior:GET_RANK} | 2成功{status:SUCCESS, userRank:{point:int}}<br />失败{status:FAIL, msg:string} |
| 获取前50名   | 1{hehavior:TOP50}            | 2成功{status:SUCCESS, top50:list[id:int, point:int, name:string]}<br />失败{status:FAIL, msg:string} |

## Game Protocol

| 行为                                   | 客户端                                                       | 服务端                                                       |
| -------------------------------------- | ------------------------------------------------------------ | ------------------------------------------------------------ |
| 发起对局                               | 1{sponsor:int, inviter:int, behavior:ADD_GAME, (如果不分先，black、white一定要有), rule:{giver:bool, giverColor:int, giverNum:int, divideFirst:bool}} | 2成功{status:SUCCESS, id:int}<br />失败{status:FAIL, msg:string} |
| 获取单个对局的简要信息（胜方，黑白方） | 1{id:int, behavior:GET_GAME}                                 | 2成功{status:SUCCESS, black:int, white:int, winner:int}<br />失败{status:FAIL, msg:string} |
| 服务器发起对局邀请                     | 2{id:int, behavior:REFUSE}<br />{id:int, behavior:AGREE}     | 1{sponsor:int, inviter:int, behavior:INVITE, (如果不分先，black、white一定要有), rule:{giver:bool, giverColor:int, giverNum:int, divideFirst:bool}} |
| 申请结算                               | 1{id:int, behavior:SCORING}                                  | 2成功{status:SUCCESS}<br />失败{status:FAIL, msg:string}     |
| 服务器发起结算                         | 2{behavior:REFUSE}<br />{behavior:AGREE}                     | 1{behavior:SCORING}                                          |
| 认输                                   | 1{id:int, behavior:SURRENDER}                                | 2成功{status:SUCCESS}<br />失败{status:FAIL, msg:string}     |
| 服务器提交对方认输                     |                                                              | 1{behavior:SURRENDER}                                        |
| 获取用户所有对局简要信息               | 1{sponsor:int, behavior:USER_ALL_GAME}                       | 2成功{status:SUCCESS, games:list}<br />失败{status:FAIL, msg:string} |

## Game Info Protocol

| 行为           | 客户端                                                       | 服务器                                                       |
| -------------- | ------------------------------------------------------------ | ------------------------------------------------------------ |
| 添加步         | 1{id:int, player:bool, stepNum:int, location:string, behavior:ADD_STEP} | 2成功{status:SUCCESS}<br />失败{status:FAIL, msg:string}     |
| 服务器发送新步 |                                                              | 1{player:bool, stepNum:int, location:string, behavior:ADD_STEP} |
| 悔棋           | 1{id:int,stepNum:int, behavior:DELETE_STEP}                  | 2成功{status:SUCCESS}<br />失败{status:FAIL, msg:string}     |
| 服务器发送悔棋 | 2{behavior:REFUSE}<br />{behavior:AGREE}                     | 1{behavior:DELETE_STEP}                                      |
| 获取所有对局步 | 1{id:int, behavior:GET_ALL_STEP}                             | 2成功{status:SUCCESS, steps:list}<br />失败{status:FAIL, msg:string} |



## Heartbeat Protocol(UDP)

| 行为         | 客户端                 | 服务器 |
| ------------ | ---------------------- | ------ |
| 发送存活信息 | 1{id:int, name:string} |        |

